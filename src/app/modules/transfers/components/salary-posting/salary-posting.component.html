<app-master-container>
    <ng-container header>Initiate Salary Posting</ng-container>
    <ng-container icons>
        <button mat-icon-button (click)="removeFile()" *ngIf="salaryRequestData.length > 0">
            <i class="las la-trash-alt"></i>
        </button>
        <button
            mat-icon-button
            #tooltip="matTooltip"
            matTooltip="Download the QIB Standard Salary Posting Template"
            (click)="downloadExcelFormat()"
        >
            <i class="las la-file-download"></i>
        </button>
    </ng-container>
    <ng-container body>
        <form [formGroup]="spForm" fxLayout="column" fxFlex="100" fxLayoutGap="1rem">
            <div fxLayout.gt-sm="row" fxLayout.xs="column" fxLayout.sm="column" fxFlex="100">
                <div class="controls">
                    <div fxFlex="50">
                        <app-account-select
                            ngDefaultControl
                            [formGroup]="spForm"
                            (selectionChange)="onChangeFromAccount($event)"
                            formControlName="fromAccount"
                            label="From Account"
                            [options]="fromAccounts"
                        >
                        </app-account-select>
                    </div>
                    <mat-form-field
                        fxFlex="50"
                        (click)="fileInput.value = ''; fileInput.click()"
                        floatLabel="never"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        fxFlex.gt-sm="30"
                        *ngIf="spForm.controls['fromAccount'].valid"
                    >
                        <mat-label>{{ fileTypeLabel }}</mat-label>
                        <input matInput formControlName="fileName" type="text" placeholder="{{ fileTypeLabel }}" />
                        <input
                            hidden
                            type="file"
                            accept="{{ acceptFileType }}"
                            multiple="false"
                            (change)="onFileSelected($event)"
                            #fileInput
                        />
                        <mat-error *ngIf="spForm.controls['fileName']?.errors?.['splChrCheck']">
                            Invalid File. File name should not contain any special characters.
                        </mat-error>
                        <mat-error *ngIf="spForm.controls['fileName']?.errors?.['onlyEnglish']">
                            Invalid File. File name should contain only english letters.
                        </mat-error>
                        <mat-error *ngIf="spForm.controls['fileName']?.errors?.['extCheck']">
                            Invalid File. Please upload only the files with {{ acceptFileType }} extensions.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
            <div
                fxLayout.gt-sm="row"
                fxLayout.xs="column"
                fxLayout.sm="column"
                fxFlex="100"
                *ngIf="!isExcelDataLoaded && tableConfig?.data?.length"
            >
                <app-label-value fxFlex="20" [label]="'Total Rows'" [value]="salaryRequestData.length.toString()">
                </app-label-value>
                <app-label-value fxFlex="20" [label]="'Currency'" [value]="'QAR'"> </app-label-value>
                <app-label-value
                    fxFlex="60"
                    [label]="'Total Amount'"
                    [value]="totalAmount.toString()"
                    [type]="'amount'"
                >
                </app-label-value>
            </div>
            <div class="file-preview" fxFlex="100" *ngIf="!isExcelDataLoaded && tableConfig?.data?.length">
                <app-cib-table [config]="tableConfig"> </app-cib-table>
            </div>

            <div fxLayout="row" fxFlex="100" class="btn-container">
                <div fxFlex="70">
                    <button
                        mat-raised-button
                        color="primary"
                        [disabled]="spForm.invalid || salaryRequestData.length < 1"
                        (click)="submitTransfer()"
                    >
                        Submit
                    </button>
                </div>
            </div>
        </form>
    </ng-container>
</app-master-container>
